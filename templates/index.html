<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –∑–≤–æ–Ω–∫–æ–≤</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <style>
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: 'Arial', sans-serif;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .spinner-border {
            display: none;
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            display: none;
            text-align: left;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìû –ê–Ω–∞–ª–∏–∑ –∑–≤–æ–Ω–∫–æ–≤</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>

        <form id="uploadForm">
            <input type="file" id="audioFile" class="form-control mb-3" accept=".wav,.mp3,.ogg">
            <button type="button" class="btn btn-primary w-100" onclick="uploadFile()">
                <span id="uploadText">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
                <div class="spinner-border spinner-border-sm text-light" id="loadingSpinner" role="status"></div>
            </button>
        </form>

        <div id="result" class="result-box">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:</h3>
            <div id="analysisContent"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function uploadFile() {
            let fileInput = document.getElementById("audioFile");
            let file = fileInput.files[0];

            if (!file) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏!");
                return;
            }

            let formData = new FormData();
            formData.append("file", file);

            let button = document.querySelector("button");
            let uploadText = document.getElementById("uploadText");
            let spinner = document.getElementById("loadingSpinner");

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Å–ø–∏–Ω–Ω–µ—Ä
            button.disabled = true;
            uploadText.style.display = "none";
            spinner.style.display = "inline-block";

            fetch("/analyze", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    formatAnalysis(data.result);
                    document.getElementById("result").style.display = "block";
                } else {
                    alert("–û—à–∏–±–∫–∞: " + data.error);
                }
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞:", error);
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞!");
            })
            .finally(() => {
                button.disabled = false;
                uploadText.style.display = "inline";
                spinner.style.display = "none";
            });
        }

        function formatAnalysis(rawText) {
            const contentDiv = document.getElementById("analysisContent");
            contentDiv.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç

            let lines = rawText.split("\n");
            lines.forEach(line => {
                if (line.startsWith("**–¢–æ–Ω:**")) {
                    let sentiment = line.match(/\*\*(.*?)\*\*/)[1];
                    let colorClass = sentiment.includes("–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π") ? "bg-danger" :
                                     sentiment.includes("–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π") ? "bg-success" :
                                     "bg-warning";
                    contentDiv.innerHTML += `<h4>üó£ –¢–æ–Ω:</h4> <span class="badge ${colorClass}">${sentiment}</span><br><p>${line.replace("**–¢–æ–Ω:**", "").replace(`**${sentiment}**`, "").trim()}</p>`;
                }
                else if (line.startsWith("**–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**")) {
                    let professionalism = line.match(/\*\*(.*?)\*\*/)[1];
                    let colorClass = professionalism.includes("–í—ã—Å–æ–∫–∏–π") ? "bg-success" :
                                     professionalism.includes("–°—Ä–µ–¥–Ω–∏–π") ? "bg-warning" :
                                     "bg-danger";
                    contentDiv.innerHTML += `<h4>üëî –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º:</h4> <span class="badge ${colorClass}">${professionalism}</span><br><p>${line.replace("**–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**", "").replace(`**${professionalism}**`, "").trim()}</p>`;
                }
                else if (line.startsWith("**–í–µ–∂–ª–∏–≤–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**")) {
                    let politeness = line.match(/\*\*(.*?)\*\*/)[1];
                    let colorClass = politeness.includes("–í—ã—Å–æ–∫–∞—è") ? "bg-success" :
                                     politeness.includes("–°—Ä–µ–¥–Ω—è—è") ? "bg-warning" :
                                     "bg-danger";
                    contentDiv.innerHTML += `<h4>üòä –í–µ–∂–ª–∏–≤–æ—Å—Ç—å:</h4> <span class="badge ${colorClass}">${politeness}</span><br><p>${line.replace("**–í–µ–∂–ª–∏–≤–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**", "").replace(`**${politeness}**`, "").trim()}</p>`;
                }
                else if (line.startsWith("**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**")) {
                    contentDiv.innerHTML += `<h4>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h4><blockquote class="blockquote">${line.replace("**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**", "").trim()}</blockquote>`;
                }
                else {
                    contentDiv.innerHTML += `<p>${line}</p>`;
                }
            });
        }
    </script>

</body>
</html>